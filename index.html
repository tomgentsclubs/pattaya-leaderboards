
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pattaya Leaderboards — Best Rated Gents Clubs in Pattaya</title>
<meta name="description" content="Rated by the Community. Trusted by the Scene. Pattaya's only community-voted Gents Club rankings — Weekly, Monthly and All-Time. Rate Gents Clubs on Value, Attractiveness, Service, Decor and more.">
<meta name="keywords" content="best gents clubs pattaya, pattaya gentlemans club ratings, darkside pattaya clubs, soi chaiyapoon clubs, jomtien gents clubs, pratumnak gents clubs, pattaya gents club reviews">
<meta name="robots" content="index, follow">
<link rel="icon" type="image/png" href="favicon.png">
<link rel="canonical" href="https://pattayaleaderboards.com/">
<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://pattayaleaderboards.com/">
<meta property="og:title" content="Pattaya Leaderboards — Best Rated Gents Clubs in Pattaya">
<meta property="og:description" content="Rated by the Community. Trusted by the Scene. Pattaya's only community-voted Gents Club rankings — Weekly, Monthly and All-Time.">
<meta property="og:image" content="https://pattayaleaderboards.com/og-image.png">
<meta property="og:site_name" content="Pattaya Leaderboards">
<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Pattaya Leaderboards — Best Rated Gents Clubs">
<meta name="twitter:description" content="Rated by the Community. Trusted by the Scene. Pattaya's only community-voted Gents Club rankings.">
<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Pattaya Leaderboards",
  "url": "https://pattayaleaderboards.com",
  "description": "Community-voted rankings of the best Gents Clubs in Pattaya, Thailand",
  "publisher": {
    "@type": "Organization",
    "name": "Gents Clubs Pattaya",
    "url": "https://gentsclubs.com"
  }
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:wght@400;600;700&family=Barlow:wght@400;500&display=swap" rel="stylesheet">
<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendEmailVerification, updateProfile, updateEmail, updatePassword, reauthenticateWithCredential, EmailAuthProvider, sendPasswordResetEmail, verifyBeforeUpdateEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, serverTimestamp, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // ─────────────────────────────────────────────
  // FIREBASE CONFIG — Replace with your own config
  // from Firebase Console > Project Settings > Your Apps
  // ─────────────────────────────────────────────
  const firebaseConfig = {
    apiKey: "AIzaSyDTfrUjV0QKRDNNkNhenhn4jPgjCo_TbvA",
    authDomain: "pattaya-leaderboards.firebaseapp.com",
    projectId: "pattaya-leaderboards",
    storageBucket: "pattaya-leaderboards.firebasestorage.app",
    messagingSenderId: "1085222184142",
    appId: "1:1085222184142:web:63fe4b080658c772105c9f"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ─────────────────────────────────────────────
  // AUTH STATE LISTENER
  // Fires whenever user logs in, logs out, or page loads
  // ─────────────────────────────────────────────
  onAuthStateChanged(auth, async (firebaseUser) => {
    if (firebaseUser) {
      if (!firebaseUser.emailVerified) {
        // User is logged in but hasn't verified email yet
        state.user = {
          uid: firebaseUser.uid,
          email: firebaseUser.email,
          username: firebaseUser.displayName || firebaseUser.email.split('@')[0],
          verified: false
        };
        updateHeader();
        renderGrid();
        showVerifyBanner();
      } else {
        // Fully authenticated and verified
        state.user = {
          uid: firebaseUser.uid,
          email: firebaseUser.email,
          username: firebaseUser.displayName || firebaseUser.email.split('@')[0],
          verified: true
        };
        hideVerifyBanner();
        // Load this user's weekly submission status from Firestore
        await loadWeeklyStatus();
        updateHeader();
        closeModal();
        renderGrid();
      }
    } else {
      // Logged out
      state.user = null;
      state.weeklyDone = {};
      updateHeader();
      renderGrid();
      hideVerifyBanner();
    }
  });

  // ─────────────────────────────────────────────
  // LOAD WEEKLY STATUS FROM FIRESTORE
  // Checks if this user has already submitted each criteria this week
  // ─────────────────────────────────────────────
  async function loadWeeklyStatus() {
    if (!state.user || !state.user.verified) return;
    const weekId = getCurrentWeekId();
    state.weeklyDone = {};
    const ref = doc(db, 'weekly_submissions', `${state.user.uid}_${weekId}`);
    const snap = await getDoc(ref);
    if (snap.exists()) {
      const data = snap.data();
      CRITERIA.forEach(c => {
        if (data[c.id]) state.weeklyDone[c.id] = true;
      });
    }
  }

  // ─────────────────────────────────────────────
  // SAVE VOTE SUBMISSION TO FIRESTORE
  // Called when user completes rating all clubs for a criteria
  // ─────────────────────────────────────────────
  window.saveSubmissionToFirestore = async function(criteriaId, rankings) {
    if (!state.user || !state.user.verified) return;
    const weekId = getCurrentWeekId();
    const submissionRef = doc(db, 'weekly_submissions', `${state.user.uid}_${weekId}`);

    // Mark this criteria as done for this week
    await setDoc(submissionRef, {
      [criteriaId]: true,
      userId: state.user.uid,
      weekId: weekId,
      updatedAt: serverTimestamp()
    }, { merge: true });

    // Save the actual vote data
    const votesRef = doc(db, 'votes', `${state.user.uid}_${criteriaId}_${weekId}`);
    await setDoc(votesRef, {
      userId: state.user.uid,
      criteriaId: criteriaId,
      weekId: weekId,
      rankings: rankings,
      submittedAt: serverTimestamp()
    });

    // Update aggregate scores in Firestore
    await updateAggregateScores(criteriaId, rankings, weekId);
  };

  // ─────────────────────────────────────────────
  // UPDATE AGGREGATE SCORES
  // Stores per-club scores for leaderboard display
  // Each vote submission creates ONE score document keyed by user+club+criteria+weekId.
  // Documents are NEVER deleted — leaderboard queries use timestamp ranges instead.
  // ─────────────────────────────────────────────
  async function updateAggregateScores(criteriaId, rankings, weekId) {
    const SCORES_MAP = {S:100, A:80, B:60, C:40, D:20, F:0};
    const now = Timestamp.now();
    const monthId = getCurrentMonthId();
    for (const [clubId, tier] of Object.entries(rankings)) {
      if (tier === 'SKIP') continue;
      const scoreVal = SCORES_MAP[tier];
      // One document per user per club per criteria per week — safe to overwrite
      const scoreRef = doc(db, 'scores', `${state.user.uid}_${clubId}_${criteriaId}_${weekId}`);
      await setDoc(scoreRef, {
        userId:     state.user.uid,
        clubId:     Number(clubId),
        criteriaId: criteriaId,
        weekId:     weekId,
        monthId:    monthId,           // e.g. "2026-02" for monthly window
        score:      scoreVal,          // this user's score for this club
        submittedAt: now               // used for rolling 7-day / 30-day windows
      });
    }
  }

  // ─────────────────────────────────────────────
  // LOAD LEADERBOARD DATA FROM FIRESTORE
  // Weekly  = rolling last 7 days  (never goes to 0 — old votes age out gradually)
  // Monthly = rolling last 30 days
  // All-time = everything ever     (never filtered)
  // ─────────────────────────────────────────────
  window.loadLeaderboardData = async function(criteriaId, timeframe) {
    let q;
    const scoresCol = collection(db, 'scores');

    if (timeframe === 'weekly') {
      const cutoff = Timestamp.fromMillis(Date.now() - 7 * 24 * 60 * 60 * 1000);
      q = query(scoresCol,
        where('criteriaId', '==', criteriaId),
        where('submittedAt', '>=', cutoff)
      );
    } else if (timeframe === 'monthly') {
      const cutoff = Timestamp.fromMillis(Date.now() - 30 * 24 * 60 * 60 * 1000);
      q = query(scoresCol,
        where('criteriaId', '==', criteriaId),
        where('submittedAt', '>=', cutoff)
      );
    } else {
      // All-time: no date filter
      q = query(scoresCol, where('criteriaId', '==', criteriaId));
    }

    const snap = await getDocs(q);
    // Aggregate: sum scores and count votes per club
    const clubMap = {};
    snap.forEach(d => {
      const data = d.data();
      const cid = data.clubId;
      // Skip documents missing the score field (old data model)
      if (typeof data.score !== 'number') return;
      if (!clubMap[cid]) clubMap[cid] = { totalScore: 0, voteCount: 0 };
      clubMap[cid].totalScore += data.score;
      clubMap[cid].voteCount  += 1;
    });
    return Object.entries(clubMap).map(([clubId, agg]) => ({
      clubId:    Number(clubId),
      avgScore:  Math.round(agg.totalScore / agg.voteCount),
      voteCount: agg.voteCount
    }));
  };

  // ─────────────────────────────────────────────
  // LOAD ALL 6 CRITERIA SCORES FOR ONE CLUB
  // Used by the club detail modal
  // ─────────────────────────────────────────────
  window.loadClubDetail = async function(clubId, timeframe) {
    const scoresCol = collection(db, 'scores');
    let cutoff = null;
    if (timeframe === 'weekly')  cutoff = Timestamp.fromMillis(Date.now() - 7  * 24 * 60 * 60 * 1000);
    if (timeframe === 'monthly') cutoff = Timestamp.fromMillis(Date.now() - 30 * 24 * 60 * 60 * 1000);

    let q = cutoff
      ? query(scoresCol, where('clubId', '==', clubId), where('submittedAt', '>=', cutoff))
      : query(scoresCol, where('clubId', '==', clubId));

    const snap = await getDocs(q);
    const critMap = {};
    snap.forEach(d => {
      const data = d.data();
      const cid = data.criteriaId;
      if (!critMap[cid]) critMap[cid] = { totalScore: 0, voteCount: 0 };
      critMap[cid].totalScore += data.score;
      critMap[cid].voteCount  += 1;
    });
    return critMap; // { value: { totalScore, voteCount }, naughty: {...}, ... }
  };
  // ─────────────────────────────────────────────
  window.firebaseRegister = async function(username, email, password) {
    try {
      showAuthLoading(true);
      const cred = await createUserWithEmailAndPassword(auth, email, password);
      // Save username to profile
      await updateProfile(cred.user, { displayName: username });
      // Save user record to Firestore
      await setDoc(doc(db, 'users', cred.user.uid), {
        username: username,
        email: email,
        createdAt: serverTimestamp()
      });
      // Send verification email
      await sendEmailVerification(cred.user);
      showAuthLoading(false);
      // Show the verify email notice inside the modal
      showVerifyEmailModal(email);
    } catch(err) {
      showAuthLoading(false);
      showAuthError(getAuthErrorMessage(err.code));
    }
  };

  window.firebaseLogin = async function(email, password) {
    try {
      showAuthLoading(true);
      await signInWithEmailAndPassword(auth, email, password);
      // onAuthStateChanged will handle the rest
      showAuthLoading(false);
    } catch(err) {
      showAuthLoading(false);
      showAuthError(getAuthErrorMessage(err.code));
    }
  };

  window.firebaseLogout = async function() {
    await signOut(auth);
  };

  window.firebaseResendVerification = async function() {
    const user = auth.currentUser;
    if (user && !user.emailVerified) {
      await sendEmailVerification(user);
      showToastMsg('Verification email resent!');
    }
  };

  window.firebaseRefreshVerification = async function() {
    const user = auth.currentUser;
    if (user) {
      await user.reload();
      if (user.emailVerified) {
        state.user.verified = true;
        hideVerifyBanner();
        await loadWeeklyStatus();
        updateHeader();
        renderGrid();
        showToastMsg('Email verified! You can now rate the Gents Clubs.');
      } else {
        showToastMsg("Email not verified yet — check your inbox.");
      }
    }
  };

  // ── ACCOUNT SETTINGS ──
  window.firebaseReauth = async function(password) {
    const user = auth.currentUser;
    const credential = EmailAuthProvider.credential(user.email, password);
    await reauthenticateWithCredential(user, credential);
  };

  window.firebaseChangeUsername = async function(newUsername) {
    const user = auth.currentUser;
    await updateProfile(user, { displayName: newUsername });
    // Update Firestore too
    const db = getFirestore();
    await setDoc(doc(db, 'users', user.uid), { username: newUsername }, { merge: true });
    state.user.username = newUsername;
    updateHeader();
  };

  window.firebaseChangePassword = async function(currentPassword, newPassword) {
    await window.firebaseReauth(currentPassword);
    await updatePassword(auth.currentUser, newPassword);
  };

  window.firebaseChangeEmail = async function(currentPassword, newEmail) {
    await window.firebaseReauth(currentPassword);
    await verifyBeforeUpdateEmail(auth.currentUser, newEmail);
  };

  window.firebaseSendPasswordReset = async function() {
    const user = auth.currentUser;
    if (user?.email) {
      await sendPasswordResetEmail(auth, user.email);
    }
  };

  window.firebaseDeleteAccount = async function(password) {
    await window.firebaseReauth(password);
    const user = auth.currentUser;
    // Delete Firestore user data
    const db = getFirestore();
    await setDoc(doc(db, 'users', user.uid), { deleted: true }, { merge: true });
    await user.delete();
  };

  // ─────────────────────────────────────────────
  // HELPERS
  // ─────────────────────────────────────────────
  function getCurrentWeekId() {
    const now = new Date();
    const day = now.getDay();
    const diff = now.getDate() - day + (day === 0 ? -6 : 1);
    const monday = new Date(now.setDate(diff));
    return `${monday.getFullYear()}-W${String(Math.ceil(monday.getDate()/7)).padStart(2,'0')}-${monday.getMonth()+1}-${monday.getDate()}`;
  }

  function getCurrentMonthId() {
    const now = new Date();
    return `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
  }

  function getAuthErrorMessage(code) {
    const msgs = {
      'auth/email-already-in-use': 'This email is already registered.',
      'auth/invalid-email': 'Please enter a valid email address.',
      'auth/weak-password': 'Password must be at least 6 characters.',
      'auth/user-not-found': 'No account found with this email.',
      'auth/wrong-password': 'Incorrect password.',
      'auth/invalid-credential': 'Incorrect email or password.',
      'auth/too-many-requests': 'Too many attempts. Please try again later.',
      'auth/network-request-failed': 'Network error. Check your connection.',
    };
    return msgs[code] || 'Something went wrong. Please try again.';
  }

  function showAuthLoading(on) {
    const btns = document.querySelectorAll('.btn-auth-submit');
    btns.forEach(b => { b.disabled = on; b.textContent = on ? 'Please wait...' : b.dataset.label; });
  }

  function showAuthError(msg) {
    // Show error in whichever view is currently visible
    const loginVisible = document.getElementById('loginView').style.display !== 'none';
    const elId = loginVisible ? 'authError' : 'authErrorReg';
    const el = document.getElementById(elId);
    if (el) { el.textContent = msg; el.style.display = 'block'; }
  }

  function showVerifyEmailModal(email) {
    document.getElementById('loginView').style.display = 'none';
    document.getElementById('registerView').style.display = 'none';
    document.getElementById('verifyEmailView').style.display = 'block';
    document.getElementById('verifyEmailAddress').textContent = email;
  }

  function showVerifyBanner() {
    document.getElementById('verifyBanner').style.display = 'flex';
  }

  function hideVerifyBanner() {
    document.getElementById('verifyBanner').style.display = 'none';
  }

  function showToastMsg(msg) {
    const t = document.getElementById('feedbackToast');
    t.textContent = msg; t.style.color = 'var(--white)';
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2000);
  }
</script>
<style>
  :root {
    --black: #0a0a0a;
    --dark: #111111;
    --card-bg: #1a1a1a;
    --border: #2a2a2a;
    --white: #ffffff;
    --off-white: #e0e0e0;
    --grey: #888888;
    --light-grey: #444444;
    --gold: #c9a84c;
    --s: #FFD700;
    --a: #98FF98;
    --b: #87CEEB;
    --c: #FFB347;
    --d: #FF8C94;
    --f: #CC5555;
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  body { background:var(--black); color:var(--white); font-family:'Barlow',sans-serif; min-height:100vh; overflow-x:hidden; }

  /* HEADER */
  .site-header { background:var(--dark); border-bottom:1px solid var(--border); padding:14px 20px; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:100; }
  .logo-area { display:flex; align-items:center; gap:10px; cursor:pointer; }
  .logo-area img { height:32px; width:auto; }
  .site-title { font-family:'Bebas Neue',sans-serif; font-size:1.5rem; letter-spacing:2px; }
  .site-subtitle { font-family:'Barlow Condensed',sans-serif; font-size:0.65rem; letter-spacing:1px; text-transform:uppercase; color:var(--grey); margin-top:-2px; }
  .header-right { display:flex; align-items:center; gap:10px; }
  .btn-login { background:transparent; border:1px solid var(--border); color:var(--grey); padding:7px 14px; font-family:'Barlow Condensed',sans-serif; font-size:0.8rem; letter-spacing:1px; text-transform:uppercase; cursor:pointer; transition:all 0.2s; border-radius:2px; }
  .btn-login:hover { border-color:var(--white); color:var(--white); }
  .btn-primary { background:var(--white); border:none; color:var(--black); padding:7px 14px; font-family:'Barlow Condensed',sans-serif; font-size:0.8rem; font-weight:700; letter-spacing:1px; text-transform:uppercase; cursor:pointer; transition:all 0.2s; border-radius:2px; }
  .btn-primary:hover { background:var(--off-white); }

  /* NAV */
  .nav-tabs { display:flex; background:var(--dark); border-bottom:1px solid var(--border); overflow-x:auto; scrollbar-width:none; }
  .nav-tabs::-webkit-scrollbar { display:none; }
  .nav-tab { padding:13px 22px; font-family:'Barlow Condensed',sans-serif; font-size:0.85rem; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; color:var(--grey); cursor:pointer; border-bottom:2px solid transparent; white-space:nowrap; transition:all 0.2s; background:none; border-top:none; border-left:none; border-right:none; }
  .nav-tab.active { color:var(--white); border-bottom-color:var(--white); }
  .nav-tab:hover:not(.active) { color:var(--off-white); }

  /* SCREENS */
  .screen { display:none; }
  .screen.active { display:block; }

  /* PAGE LAYOUT */
  .page-wrap { max-width:680px; margin:0 auto; padding:28px 16px; }
  .page-heading { font-family:'Bebas Neue',sans-serif; font-size:2rem; letter-spacing:3px; margin-bottom:4px; }
  .page-sub { font-size:0.85rem; color:var(--grey); margin-bottom:24px; line-height:1.5; }

  /* RESET NOTICE */
  .reset-notice { display:flex; align-items:center; gap:10px; background:var(--card-bg); border:1px solid var(--border); border-radius:6px; padding:12px 16px; margin-bottom:22px; font-size:0.8rem; color:var(--grey); }
  .reset-dot { width:6px; height:6px; background:var(--gold); border-radius:50%; flex-shrink:0; animation:pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* GUEST NOTICE */
  .guest-notice { background:var(--card-bg); border:1px solid var(--border); border-radius:8px; padding:20px; text-align:center; margin-bottom:24px; }
  .guest-notice p { font-size:0.88rem; color:var(--grey); margin-bottom:14px; line-height:1.5; }
  .guest-actions { display:flex; gap:10px; justify-content:center; }

  /* CRITERIA GRID */
  .criteria-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; }
  @media(max-width:480px){ .criteria-grid{grid-template-columns:1fr;} }

  .criteria-card { background:var(--card-bg); border:1px solid var(--border); border-radius:8px; padding:20px 18px; cursor:pointer; transition:all 0.2s; position:relative; overflow:hidden; }
  .criteria-card.available:hover { border-color:var(--white); transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,0,0,0.4); }
  .criteria-card.completed { border-color:var(--gold); opacity:0.75; cursor:default; }
  .criteria-card.locked { opacity:0.4; cursor:default; }

  .cc-icon { font-size:1.8rem; margin-bottom:10px; line-height:1; }
  .cc-title { font-family:'Barlow Condensed',sans-serif; font-size:1.05rem; font-weight:700; letter-spacing:0.5px; text-transform:uppercase; margin-bottom:4px; }
  .cc-desc { font-size:0.78rem; color:var(--grey); line-height:1.4; margin-bottom:14px; }
  .cc-status { font-family:'Barlow Condensed',sans-serif; font-size:0.75rem; font-weight:600; letter-spacing:1px; text-transform:uppercase; }
  .status-available { color:var(--white); }
  .status-completed { color:var(--gold); }
  .status-locked { color:var(--grey); }
  .cc-arrow { position:absolute; right:16px; top:50%; transform:translateY(-50%); font-size:1.1rem; color:var(--light-grey); transition:all 0.2s; }
  .criteria-card.available:hover .cc-arrow { color:var(--white); right:12px; }
  .cc-prog { position:absolute; bottom:0; left:0; height:2px; background:var(--white); transition:width 0.4s; }
  .criteria-card.completed .cc-prog { background:var(--gold); }

  /* VOTE PAGE */
  .vote-wrap { max-width:520px; margin:0 auto; padding:20px 16px; }
  .vote-top { display:flex; align-items:center; gap:14px; margin-bottom:22px; }
  .back-btn { background:transparent; border:1px solid var(--border); color:var(--grey); width:38px; height:38px; border-radius:4px; cursor:pointer; font-size:1.1rem; display:flex; align-items:center; justify-content:center; transition:all 0.2s; flex-shrink:0; }
  .back-btn:hover { border-color:var(--white); color:var(--white); }
  .vote-crit-title { font-family:'Bebas Neue',sans-serif; font-size:1.6rem; letter-spacing:2px; line-height:1; }
  .vote-crit-sub { font-size:0.75rem; color:var(--grey); margin-top:2px; }

  /* Progress */
  .vote-prog { margin-bottom:22px; }
  .vp-row { display:flex; justify-content:space-between; align-items:baseline; margin-bottom:8px; }
  .vp-pct { font-family:'Bebas Neue',sans-serif; font-size:1.2rem; color:var(--gold); }
  .vp-label { font-family:'Barlow Condensed',sans-serif; font-size:0.75rem; letter-spacing:1px; text-transform:uppercase; color:var(--grey); }
  .vp-track { height:3px; background:var(--border); border-radius:2px; overflow:hidden; }
  .vp-fill { height:100%; background:var(--white); border-radius:2px; transition:width 0.4s ease; }

  /* Club card */
  .card-stage { position:relative; display:flex; align-items:center; justify-content:center; margin-bottom:22px; min-height:110px; }
  .club-card { width:100%; background:var(--card-bg); border:1px solid var(--border); border-radius:10px; padding:22px 20px; display:flex; align-items:center; gap:18px; position:absolute; transition:transform 0.3s ease, opacity 0.3s ease; }
  .club-logo-box { width:72px; height:72px; background:var(--border); border-radius:6px; display:flex; align-items:center; justify-content:center; font-family:'Bebas Neue',sans-serif; font-size:1.9rem; color:var(--grey); flex-shrink:0; overflow:hidden; }
  .club-logo-box img { width:100%; height:100%; object-fit:contain; padding:6px; }
  .club-info { flex:1; min-width:0; }
  .club-name { font-family:'Bebas Neue',sans-serif; font-size:1.55rem; letter-spacing:2px; line-height:1.1; margin-bottom:4px; }
  .club-area { font-family:'Barlow Condensed',sans-serif; font-size:0.72rem; letter-spacing:2px; text-transform:uppercase; color:var(--grey); }
  .card-num { position:absolute; top:10px; right:14px; font-family:'Barlow Condensed',sans-serif; font-size:0.68rem; letter-spacing:1px; color:var(--light-grey); }

  /* Tier buttons */
  .tier-label { font-family:'Barlow Condensed',sans-serif; font-size:0.72rem; letter-spacing:2px; text-transform:uppercase; color:var(--grey); text-align:center; margin-bottom:10px; }
  .tier-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:8px; }
  .tier-btn { padding:16px 8px 12px; border-radius:6px; font-family:'Bebas Neue',sans-serif; font-size:1.6rem; letter-spacing:2px; cursor:pointer; border:1px solid; background:var(--card-bg); display:flex; flex-direction:column; align-items:center; gap:2px; user-select:none; transition:all 0.15s; }
  .tier-btn:active { transform:scale(0.94); }
  .tier-btn span { display:block; font-family:'Barlow',sans-serif; font-size:0.57rem; font-weight:500; opacity:0.65; text-transform:uppercase; letter-spacing:0.3px; }
  .ts { color:var(--s); border-color:rgba(255,215,0,0.2); } .ts:hover{background:rgba(255,215,0,0.08);border-color:rgba(255,215,0,0.5);}
  .ta { color:var(--a); border-color:rgba(152,255,152,0.2); } .ta:hover{background:rgba(152,255,152,0.08);border-color:rgba(152,255,152,0.5);}
  .tb { color:var(--b); border-color:rgba(135,206,235,0.2); } .tb:hover{background:rgba(135,206,235,0.08);border-color:rgba(135,206,235,0.5);}
  .tc { color:var(--c); border-color:rgba(255,179,71,0.2); } .tc:hover{background:rgba(255,179,71,0.08);border-color:rgba(255,179,71,0.5);}
  .td { color:var(--d); border-color:rgba(255,140,148,0.2); } .td:hover{background:rgba(255,140,148,0.08);border-color:rgba(255,140,148,0.5);}
  .tf { color:var(--f); border-color:rgba(204,85,85,0.2); } .tf:hover{background:rgba(204,85,85,0.08);border-color:rgba(204,85,85,0.5);}
  .skip-btn { width:100%; padding:13px; background:transparent; border:1px dashed var(--border); border-radius:6px; color:var(--grey); font-family:'Barlow Condensed',sans-serif; font-size:0.85rem; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; cursor:pointer; transition:all 0.2s; }
  .skip-btn:hover { border-color:var(--grey); color:var(--off-white); }
  .exit-actions { display:flex; flex-direction:column; gap:10px; margin-top:4px; }
  .exit-btn-continue { padding:14px; background:var(--gold); color:var(--black); border:none; border-radius:6px; font-family:'Barlow Condensed',sans-serif; font-size:1rem; font-weight:700; letter-spacing:1px; text-transform:uppercase; cursor:pointer; transition:all 0.2s; }
  .exit-btn-continue:hover { background:#e8c84a; }
  .exit-btn-submit { padding:14px; background:transparent; border:1px solid var(--gold); color:var(--gold); border-radius:6px; font-family:'Barlow Condensed',sans-serif; font-size:1rem; font-weight:700; letter-spacing:1px; text-transform:uppercase; cursor:pointer; transition:all 0.2s; }
  .exit-btn-submit:hover { background:rgba(201,168,76,0.1); }
  .exit-btn-discard { padding:14px; background:transparent; border:1px dashed var(--border); color:var(--grey); border-radius:6px; font-family:'Barlow Condensed',sans-serif; font-size:0.9rem; font-weight:600; letter-spacing:1px; text-transform:uppercase; cursor:pointer; transition:all 0.2s; }
  .exit-btn-discard:hover { border-color:var(--grey); color:var(--off-white); }
  /* ── SETTINGS MODAL ── */
  .settings-tabs { display:flex; gap:4px; margin-bottom:20px; border-bottom:1px solid var(--border); padding-bottom:12px; }
  .settings-tab { background:transparent; border:none; color:var(--grey); font-family:'Barlow Condensed',sans-serif; font-size:0.85rem; font-weight:700; letter-spacing:1px; text-transform:uppercase; padding:7px 14px; border-radius:4px; cursor:pointer; transition:all 0.15s; }
  .settings-tab:hover { color:var(--off-white); background:var(--border); }
  .settings-tab.active { background:rgba(201,168,76,0.15); color:var(--gold); }
  .settings-panel { display:none; }
  .settings-panel.active { display:block; }
  .settings-field { margin-bottom:14px; }
  .settings-field label { display:block; font-family:'Barlow Condensed',sans-serif; font-size:0.75rem; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; color:var(--grey); margin-bottom:6px; }
  .settings-field input { width:100%; padding:10px 12px; background:var(--black); border:1px solid var(--border); border-radius:4px; color:var(--off-white); font-family:'Barlow',sans-serif; font-size:0.9rem; box-sizing:border-box; }
  .settings-field input:focus { outline:none; border-color:var(--gold); }
  .settings-hint { font-size:0.78rem; color:var(--grey); margin-top:5px; line-height:1.4; }
  .settings-divider { border:none; border-top:1px solid var(--border); margin:18px 0; }
  .btn-danger { padding:11px 18px; background:transparent; border:1px solid rgba(224,85,85,0.4); color:#e05555; border-radius:4px; font-family:'Barlow Condensed',sans-serif; font-size:0.9rem; font-weight:700; letter-spacing:1px; text-transform:uppercase; cursor:pointer; transition:all 0.2s; }
  .btn-danger:hover { background:rgba(224,85,85,0.1); border-color:#e05555; color:#ff7777; }
  .user-btn { background:transparent; border:1px solid var(--border); color:var(--grey); font-family:'Barlow Condensed',sans-serif; font-size:0.82rem; letter-spacing:1px; text-transform:uppercase; padding:6px 12px; border-radius:4px; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:6px; }
  .user-btn:hover { border-color:var(--gold); color:var(--gold); }

  /* Toast */
  .feedback-toast { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.75); background:rgba(17,17,17,0.95); border:1px solid var(--border); border-radius:10px; padding:16px 34px; font-family:'Bebas Neue',sans-serif; font-size:2.6rem; letter-spacing:4px; opacity:0; pointer-events:none; transition:opacity 0.18s,transform 0.18s; z-index:999; backdrop-filter:blur(8px); }
  .feedback-toast.show { opacity:1; transform:translate(-50%,-50%) scale(1); }

  /* Complete */
  .vote-complete { display:none; text-align:center; padding:36px 20px; }
  .vote-complete.show { display:block; }
  .complete-ring { width:60px; height:60px; border:2px solid var(--gold); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 18px; font-size:1.7rem; color:var(--gold); }
  .complete-title { font-family:'Bebas Neue',sans-serif; font-size:2.3rem; letter-spacing:3px; margin-bottom:8px; }
  .complete-sub { font-size:0.88rem; color:var(--grey); line-height:1.6; margin-bottom:26px; max-width:300px; margin-left:auto; margin-right:auto; }
  .complete-actions { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  .btn-outline { background:transparent; border:1px solid var(--border); color:var(--white); padding:11px 20px; font-family:'Barlow Condensed',sans-serif; font-size:0.85rem; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; cursor:pointer; transition:all 0.2s; border-radius:2px; }
  .btn-outline:hover { background:var(--border); }

  /* LEADERBOARD */
  .lb-pills { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:18px; }
  .pill { padding:7px 15px; border:1px solid var(--border); border-radius:100px; font-family:'Barlow Condensed',sans-serif; font-size:0.82rem; font-weight:600; letter-spacing:0.5px; cursor:pointer; transition:all 0.2s; background:transparent; color:var(--grey); }
  .pill.active { background:var(--white); color:var(--black); border-color:var(--white); }
  .pill:hover:not(.active) { border-color:var(--white); color:var(--white); }
  .time-tabs { display:flex; border:1px solid var(--border); border-radius:4px; overflow:hidden; margin-bottom:22px; }
  .time-tab { flex:1; padding:10px; font-family:'Barlow Condensed',sans-serif; font-size:0.8rem; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; text-align:center; cursor:pointer; background:transparent; color:var(--grey); border:none; transition:all 0.2s; }
  .time-tab.active { background:var(--white); color:var(--black); }
  .lb-list { display:flex; flex-direction:column; gap:8px; }
  .lb-empty { text-align:center; padding:48px 20px; color:var(--grey); font-family:'Barlow Condensed',sans-serif; font-size:0.95rem; letter-spacing:0.5px; }

  /* CLUB DETAIL MODAL */
  .club-modal-header { display:flex; align-items:center; gap:14px; margin-bottom:20px; padding-bottom:16px; border-bottom:1px solid var(--border); }
  .club-modal-logo { width:56px; height:56px; background:var(--border); border-radius:6px; display:flex; align-items:center; justify-content:center; font-family:'Bebas Neue',sans-serif; font-size:1.4rem; color:var(--grey); flex-shrink:0; overflow:hidden; }
  .club-modal-logo img { width:100%; height:100%; object-fit:contain; padding:4px; }
  .club-modal-name { font-family:'Bebas Neue',sans-serif; font-size:1.6rem; letter-spacing:2px; line-height:1; }
  .club-modal-area { font-family:'Barlow Condensed',sans-serif; font-size:0.72rem; letter-spacing:2px; text-transform:uppercase; color:var(--grey); margin-top:3px; }
  .club-modal-links { display:flex; gap:8px; margin-top:6px; }
  .criteria-scores { display:flex; flex-direction:column; gap:10px; margin-bottom:20px; }
  .criteria-score-row { display:flex; align-items:center; gap:12px; }
  .cs-label { font-family:'Barlow Condensed',sans-serif; font-size:0.82rem; font-weight:600; letter-spacing:0.5px; color:var(--off-white); flex:1; }
  .cs-bar-wrap { flex:2; height:6px; background:var(--border); border-radius:3px; overflow:hidden; }
  .cs-bar { height:100%; border-radius:3px; transition:width 0.4s ease; }
  .cs-score { font-family:'Bebas Neue',sans-serif; font-size:1.1rem; width:36px; text-align:right; flex-shrink:0; }
  .cs-votes { font-size:0.68rem; color:var(--grey); width:44px; text-align:right; flex-shrink:0; }
  .club-modal-empty { text-align:center; padding:24px 0; color:var(--grey); font-size:0.88rem; }
  .lb-item { display:flex; align-items:center; gap:14px; background:var(--card-bg); border:1px solid var(--border); border-radius:6px; padding:13px 16px; transition:border-color 0.2s; }
  .lb-item:hover { border-color:var(--light-grey); }
  .lb-rank { font-family:'Bebas Neue',sans-serif; font-size:1.7rem; color:var(--grey); width:30px; text-align:center; flex-shrink:0; }
  .lb-item:nth-child(1) .lb-rank{color:var(--s)} .lb-item:nth-child(2) .lb-rank{color:var(--off-white)} .lb-item:nth-child(3) .lb-rank{color:var(--gold)}
  .lb-logo { width:42px; height:42px; background:var(--border); border-radius:4px; display:flex; align-items:center; justify-content:center; font-family:'Bebas Neue',sans-serif; font-size:1rem; color:var(--grey); flex-shrink:0; overflow:hidden; }
  .lb-logo img { width:100%; height:100%; object-fit:contain; padding:4px; }
  .lb-links { display:flex; gap:6px; margin-top:6px; }
  .lb-link { display:inline-flex; align-items:center; gap:4px; padding:3px 9px; border-radius:20px; font-family:'Barlow Condensed',sans-serif; font-size:0.75rem; font-weight:700; letter-spacing:0.8px; text-transform:uppercase; text-decoration:none; transition:all 0.2s; line-height:1.4; }
  .lb-link-maps { background:rgba(66,133,244,0.15); color:#6aa3f8; border:1px solid rgba(66,133,244,0.3); }
  .lb-link-maps:hover { background:rgba(66,133,244,0.28); border-color:rgba(66,133,244,0.6); color:#90bfff; }
  .lb-link-gc { background:rgba(201,168,76,0.12); color:var(--gold); border:1px solid rgba(201,168,76,0.3); }
  .lb-link-gc:hover { background:rgba(201,168,76,0.24); border-color:rgba(201,168,76,0.6); }
  .lb-info { flex:1; min-width:0; }
  .lb-name { font-family:'Barlow Condensed',sans-serif; font-size:1rem; font-weight:700; letter-spacing:0.5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .lb-meta { font-size:0.72rem; color:var(--grey); margin-top:2px; }
  .lb-score-wrap { text-align:right; flex-shrink:0; }
  .lb-score { font-family:'Bebas Neue',sans-serif; font-size:1.7rem; line-height:1; }
  .lb-score-lbl { font-size:0.62rem; letter-spacing:1px; text-transform:uppercase; color:var(--grey); }
  .sh { color:var(--a); } .sm { color:var(--c); } .sl { color:var(--d); }

  /* HOW IT WORKS */
  .how-step { display:flex; gap:16px; margin-bottom:24px; }
  .step-num { font-family:'Bebas Neue',sans-serif; font-size:2.8rem; line-height:1; color:var(--border); flex-shrink:0; width:44px; }
  .step-title { font-family:'Barlow Condensed',sans-serif; font-size:1.05rem; font-weight:700; letter-spacing:1px; text-transform:uppercase; margin-bottom:4px; }
  .step-desc { font-size:0.88rem; color:var(--grey); line-height:1.6; }
  .tier-ref { background:var(--card-bg); border:1px solid var(--border); border-radius:8px; padding:20px; margin-top:28px; }
  .tier-ref-lbl { font-family:'Barlow Condensed',sans-serif; font-size:0.72rem; letter-spacing:2px; text-transform:uppercase; color:var(--grey); margin-bottom:14px; }
  .tier-ref-row { display:flex; align-items:center; gap:14px; padding:9px 0; border-bottom:1px solid var(--border); }
  .tier-ref-row:last-child{border-bottom:none}
  .tier-badge { font-family:'Bebas Neue',sans-serif; font-size:1.4rem; width:28px; text-align:center; }
  .tier-ref-desc { font-size:0.84rem; color:var(--off-white); }
  .tier-ref-pts { font-family:'Barlow Condensed',sans-serif; font-size:0.78rem; color:var(--grey); margin-left:auto; }

  /* AUTH MODAL */
  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.88); z-index:200; display:flex; align-items:center; justify-content:center; padding:20px; opacity:0; pointer-events:none; transition:opacity 0.2s; }
  .modal-overlay.show { opacity:1; pointer-events:all; }
  .modal { background:var(--dark); border:1px solid var(--border); border-radius:8px; padding:28px 24px; width:100%; max-width:370px; transform:translateY(16px); transition:transform 0.2s; position:relative; }
  .modal-overlay.show .modal { transform:translateY(0); }
  .modal-title { font-family:'Bebas Neue',sans-serif; font-size:1.9rem; letter-spacing:3px; margin-bottom:4px; }
  .modal-sub { font-size:0.82rem; color:var(--grey); margin-bottom:20px; }
  .form-group { margin-bottom:13px; }
  .form-label { display:block; font-family:'Barlow Condensed',sans-serif; font-size:0.72rem; letter-spacing:1.5px; text-transform:uppercase; color:var(--grey); margin-bottom:5px; }
  .form-input { width:100%; padding:11px 13px; background:var(--card-bg); border:1px solid var(--border); border-radius:4px; color:var(--white); font-family:'Barlow',sans-serif; font-size:0.92rem; outline:none; transition:border-color 0.2s; }
  .form-input:focus { border-color:var(--white); }
  .modal-actions { display:flex; gap:10px; margin-top:16px; }
  .btn-block { flex:1; padding:12px; font-family:'Barlow Condensed',sans-serif; font-size:0.85rem; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; cursor:pointer; border-radius:3px; transition:all 0.2s; }
  .modal-close { position:absolute; top:13px; right:13px; background:none; border:none; color:var(--grey); font-size:1.4rem; cursor:pointer; line-height:1; padding:4px; }
  .modal-close:hover { color:var(--white); }

  /* VERIFY EMAIL BANNER */
  .verify-banner { display:none; align-items:center; gap:12px; background:#1a1200; border-bottom:1px solid #4a3500; padding:11px 20px; font-size:0.82rem; flex-wrap:wrap; }
  .verify-banner-icon { font-size:1rem; flex-shrink:0; }
  .verify-banner-text { color:#FFB347; flex:1; min-width:160px; }
  .verify-banner-text strong { color:#FFD700; }
  .verify-banner-actions { display:flex; gap:8px; flex-shrink:0; }
  .btn-verify-small { padding:6px 12px; font-family:'Barlow Condensed',sans-serif; font-size:0.72rem; font-weight:700; letter-spacing:1px; text-transform:uppercase; cursor:pointer; border-radius:2px; transition:all 0.2s; }
  .btn-verify-resend { background:transparent; border:1px solid #4a3500; color:#FFB347; }
  .btn-verify-resend:hover { border-color:#FFB347; }
  .btn-verify-check { background:#FFD700; border:none; color:#000; }
  .btn-verify-check:hover { background:#FFB347; }

  /* AUTH ERROR */
  .auth-error { display:none; background:rgba(204,85,85,0.12); border:1px solid rgba(204,85,85,0.3); border-radius:4px; padding:10px 13px; font-size:0.82rem; color:#FF8C94; margin-bottom:12px; }

  /* VERIFY EMAIL VIEW IN MODAL */
  .verify-modal-icon { font-size:2.8rem; margin-bottom:14px; }
  .verify-modal-email { font-family:'Barlow Condensed',sans-serif; font-size:0.95rem; font-weight:700; color:var(--gold); word-break:break-all; margin:8px 0 16px; }
  .verify-modal-steps { font-size:0.82rem; color:var(--grey); line-height:1.7; margin-bottom:20px; }

  /* LOADING STATE ON BUTTONS */
  .btn-auth-submit:disabled { opacity:0.55; cursor:not-allowed; }
</style>
</head>
<body>

<div class="feedback-toast" id="feedbackToast"></div>

<!-- EMAIL VERIFICATION BANNER -->
<div class="verify-banner" id="verifyBanner">
  <div class="verify-banner-icon">✉️</div>
  <div class="verify-banner-text"><strong>Verify your email</strong> — Check your inbox and click the link to start rating clubs.</div>
  <div class="verify-banner-actions">
    <button class="btn-verify-small btn-verify-resend" onclick="firebaseResendVerification()">Resend Email</button>
    <button class="btn-verify-small btn-verify-check" onclick="firebaseRefreshVerification()">I've Verified ✓</button>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="modal-overlay" id="authModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">×</button>

    <!-- LOGIN VIEW -->
    <div id="loginView">
      <div class="modal-title">Sign In</div>
      <div class="modal-sub">Access your rankings and weekly history</div>
      <div class="auth-error" id="authError"></div>
      <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" placeholder="your@email.com" id="loginEmail"></div>
      <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" placeholder="••••••••" id="loginPass"></div>
      <div class="modal-actions">
        <button class="btn-block btn-outline" onclick="switchToRegister()">Register</button>
        <button class="btn-block btn-primary btn-auth-submit" data-label="Sign In" onclick="doLogin()">Sign In</button>
      </div>
    </div>

    <!-- REGISTER VIEW -->
    <div id="registerView" style="display:none">
      <div class="modal-title">Register</div>
      <div class="modal-sub">Free account — start ranking immediately</div>
      <div class="auth-error" id="authErrorReg"></div>
      <div class="form-group"><label class="form-label">Username</label><input type="text" class="form-input" placeholder="YourUsername" id="regUsername"></div>
      <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" placeholder="your@email.com" id="regEmail"></div>
      <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" placeholder="Min 6 characters" id="regPass"></div>
      <div class="modal-actions">
        <button class="btn-block btn-outline" onclick="switchToLogin()">Sign In</button>
        <button class="btn-block btn-primary btn-auth-submit" data-label="Create Account" onclick="doRegister()">Create Account</button>
      </div>
    </div>

    <!-- VERIFY EMAIL VIEW (shown after registration) -->
    <div id="verifyEmailView" style="display:none; text-align:center;">
      <div class="verify-modal-icon">✉️</div>
      <div class="modal-title">Check Your Email</div>
      <div class="modal-sub">We sent a verification link to:</div>
      <div class="verify-modal-email" id="verifyEmailAddress"></div>
      <div class="verify-modal-steps">
        1. Open your email inbox<br>
        2. Click the verification link<br>
        3. Come back and tap the button below
      </div>
      <button class="btn-block btn-primary" style="margin-bottom:10px" onclick="firebaseRefreshVerification(); closeModal();">I've Verified My Email ✓</button>
      <button class="btn-block btn-outline" onclick="firebaseResendVerification()">Resend Verification Email</button>
    </div>

  </div>
</div>

<!-- HEADER -->
<header class="site-header">
  <div class="logo-area" onclick="goHome()">
    <img src="logo.png" alt="Pattaya Leaderboards" style="height:32px;width:auto;">
    <div>
      <div class="site-title">Pattaya Leaderboards</div>
      <div class="site-subtitle">By GentsClubs.com</div>
    </div>
  </div>
  <div class="header-right" id="headerRight">
    <button class="btn-login" onclick="openModal('login')">Sign In</button>
    <button class="btn-primary" onclick="openModal('register')">Register</button>
  </div>
</header>

<!-- NAV -->
<nav class="nav-tabs">
  <button class="nav-tab active" id="tab-rate" onclick="showScreen('rate',this)">Rate Clubs</button>
  <button class="nav-tab" id="tab-lb" onclick="showScreen('leaderboard',this)">Leaderboards</button>
  <button class="nav-tab" id="tab-how" onclick="showScreen('how',this)">How It Works</button>
</nav>

<!-- ═══ RATE SCREEN ═══ -->
<div class="screen active" id="screen-rate">

  <!-- CRITERIA HOME -->
  <div id="criteriaHome">
    <div class="page-wrap">
      <div class="page-heading">Rate Gents Clubs</div>
      <div class="page-sub">Select a criteria to begin. Each criteria can be rated once per week — resets every Sunday at midnight.</div>
      <div class="reset-notice"><div class="reset-dot"></div><span id="resetTimer">Calculating reset time...</span></div>
      <div class="guest-notice" id="guestNotice">
        <p>Create a free account to submit rankings and contribute to the community leaderboards.</p>
        <div class="guest-actions">
          <button class="btn-outline" onclick="openModal('login')">Sign In</button>
          <button class="btn-primary" onclick="openModal('register')">Create Free Account</button>
        </div>
      </div>
      <div class="criteria-grid" id="criteriaGrid"></div>
    </div>
  </div>

  <!-- VOTE PAGE -->
  <div id="votePage" style="display:none">
    <div class="vote-wrap">
      <div class="vote-top">
        <button class="back-btn" onclick="goHome()">←</button>
        <div>
          <div class="vote-crit-title" id="vCritTitle"></div>
          <div class="vote-crit-sub" id="vCritSub"></div>
        </div>
      </div>
      <div class="vote-prog">
        <div class="vp-row"><span class="vp-label">Progress</span><span class="vp-pct" id="vProgPct">0%</span></div>
        <div class="vp-track"><div class="vp-fill" id="vProgFill" style="width:0%"></div></div>
      </div>
      <div class="card-stage" id="cardStage">
        <div class="club-card" id="clubCard">
          <div class="card-num" id="cardNum"></div>
          <div class="club-logo-box" id="clubLogo"></div>
          <div class="club-info">
            <div class="club-name" id="clubName">—</div>
            <div class="club-area" id="clubArea"></div>
          </div>
        </div>
      </div>
      <div class="vote-complete" id="voteComplete">
        <div class="complete-ring">✓</div>
        <div class="complete-title">Criteria Complete!</div>
        <div class="complete-sub">Your rankings are saved. Come back next Sunday to rate again and keep the data fresh.</div>
        <div class="complete-actions">
          <button class="btn-outline" onclick="goHome()">Rate Another Criteria</button>
          <button class="btn-primary" onclick="showScreen('leaderboard',document.getElementById('tab-lb'))">View Leaderboards</button>
        </div>
      </div>
      <div id="tierSection">
        <div class="tier-label">Tap a Tier to Rate This Gents Club</div>
        <div class="tier-grid">
          <button class="tier-btn ts" onclick="assign('S')">S<span>Elite</span></button>
          <button class="tier-btn ta" onclick="assign('A')">A<span>Great</span></button>
          <button class="tier-btn tb" onclick="assign('B')">B<span>Good</span></button>
          <button class="tier-btn tc" onclick="assign('C')">C<span>Average</span></button>
          <button class="tier-btn td" onclick="assign('D')">D<span>Below Avg</span></button>
          <button class="tier-btn tf" onclick="assign('F')">F<span>Poor</span></button>
        </div>
        <button class="skip-btn" onclick="assign('SKIP')">Skip — Haven't Visited This Gents Club</button>
      </div>
    </div>
  </div>
</div>

<!-- ═══ LEADERBOARD SCREEN ═══ -->
<div class="screen" id="screen-leaderboard">
  <div class="page-wrap">
    <div class="page-heading">Leaderboards</div>
    <div class="page-sub">Rated by the Community. Trusted by the Scene. Weekly, Monthly and All-Time.</div>
    <div class="lb-pills" id="lbPills"></div>
    <div class="time-tabs">
      <button class="time-tab active" onclick="setTime('weekly',this)">This Week</button>
      <button class="time-tab" onclick="setTime('monthly',this)">This Month</button>
      <button class="time-tab" onclick="setTime('alltime',this)">All Time</button>
    </div>
    <div class="lb-list" id="lbList"></div>
  </div>
</div>

<!-- ═══ CLUB DETAIL MODAL ═══ -->
<div class="modal-overlay" id="clubModal">
  <div class="modal" style="max-width:420px">
    <button class="modal-close" onclick="closeClubModal()">×</button>
    <div id="clubModalContent">
      <!-- populated by openClubModal() -->
    </div>
  </div>
</div>

<!-- ═══ HOW IT WORKS SCREEN ═══ -->
<div class="screen" id="screen-how">
  <div class="page-wrap">
    <div class="page-heading">How It Works</div>
    <div class="page-sub" style="margin-bottom:28px">Rated by the Community. Trusted by the Scene.</div>
    <div class="how-step"><div class="step-num">01</div><div><div class="step-title">Create a Free Account</div><div class="step-desc">Register with your email to save rankings and contribute to the community leaderboards. Submissions are anonymous.</div></div></div>
    <div class="how-step"><div class="step-num">02</div><div><div class="step-title">Choose a Criteria</div><div class="step-desc">Pick from 6 categories: Value for Money, Naughtiness, Attractiveness of Ladies, Number of Ladies, Decor & Facilities, or Level of Service.</div></div></div>
    <div class="how-step"><div class="step-num">03</div><div><div class="step-title">Rate Each Gents Club</div><div class="step-desc">Gents Club cards appear one at a time. Tap a tier from S (Elite) to F (Poor). Skip any clubs you haven't personally visited.</div></div></div>
    <div class="how-step"><div class="step-num">04</div><div><div class="step-title">Weekly Reset Every Sunday</div><div class="step-desc">You can submit ratings once per week per criteria — your slot resets every Sunday at midnight. Leaderboard scores use a rolling 7-day window, so rankings shift gradually as votes age out rather than dropping to zero on reset day.</div></div></div>
    <div class="how-step"><div class="step-num">05</div><div><div class="step-title">View the Leaderboards</div><div class="step-desc">All submissions roll up into Weekly, Monthly and All-Time Top 10 leaderboards per criteria. The rolling windows mean scores always reflect real, current opinion — not a club's reputation from two years ago. Weekly keeps things fresh, Monthly smooths out the noise, All-Time shows who consistently leads the scene.</div></div></div>
    <div class="tier-ref">
      <div class="tier-ref-lbl">Tier Scoring Reference</div>
      <div class="tier-ref-row"><span class="tier-badge" style="color:var(--s)">S</span><span class="tier-ref-desc">Elite — Absolute best in Pattaya</span><span class="tier-ref-pts">100 pts</span></div>
      <div class="tier-ref-row"><span class="tier-badge" style="color:var(--a)">A</span><span class="tier-ref-desc">Great — Highly recommended</span><span class="tier-ref-pts">80 pts</span></div>
      <div class="tier-ref-row"><span class="tier-badge" style="color:var(--b)">B</span><span class="tier-ref-desc">Good — Worth a visit</span><span class="tier-ref-pts">60 pts</span></div>
      <div class="tier-ref-row"><span class="tier-badge" style="color:var(--c)">C</span><span class="tier-ref-desc">Average — Nothing special</span><span class="tier-ref-pts">40 pts</span></div>
      <div class="tier-ref-row"><span class="tier-badge" style="color:var(--d)">D</span><span class="tier-ref-desc">Below Average — Disappointing</span><span class="tier-ref-pts">20 pts</span></div>
      <div class="tier-ref-row"><span class="tier-badge" style="color:var(--f)">F</span><span class="tier-ref-desc">Poor — Avoid</span><span class="tier-ref-pts">0 pts</span></div>
    </div>
  </div>
</div>

<script>

const CRITERIA=[
  {id:'value',  label:'Value for Money',    icon:'💰',desc:'How far does your money go?'},
  {id:'naughty',label:'Naughtiness',        icon:'🔥',desc:'How wild does it get?'},
  {id:'attract',label:'Attractiveness',     icon:'⭐',desc:'How attractive are the ladies?'},
  {id:'ladies', label:'Number of Ladies',   icon:'👯',desc:'How many ladies are there?'},
  {id:'decor',  label:'Decor & Facilities', icon:'🏛',desc:'Quality of the venue and facilities'},
  {id:'service',label:'Level of Service',   icon:'🍸',desc:'Staff attitude and service quality'},
];

const CLUBS=[
  {id:1 , name:'007 Club', area:'Soi Bonkot 8', initial:'0', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_ce9d972754724481a9d79aa160880f8e~mv2.jpg', maps:'https://goo.gl/maps/tZmCDrE52hCHpWBp9', gc:'https://gentsclubs.com/gc/007-club'},
  {id:2 , name:'Amsterdam', area:'Soi Bonkot 8', initial:'A', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_bf256499db50434a9a5dbc9eb0438db2~mv2.jpg', maps:'https://goo.gl/maps/NRE3W8PJmfbJ96vHA', gc:'https://gentsclubs.com/gc/amsterdam'},
  {id:3 , name:'Aqua-Deymie', area:'The Darkside', initial:'A', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_5c5160f0cef84f35be5e7c11da108319~mv2.png', maps:'https://goo.gl/maps/EZcCwvutMmHJ9SYG9', gc:'https://gentsclubs.com/gc/aqua-deymie'},
  {id:4 , name:'Azure Fabrice', area:'The Darkside', initial:'A', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_0a6d21bc91894a8a897fc1cf7038a05e~mv2.jpg', maps:'https://goo.gl/maps/ULNy62UjEMCjTkR77', gc:'https://gentsclubs.com/gc/azure-fabrice'},
  {id:5 , name:'Babylon', area:'Soi Bonkot 5', initial:'B', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_4116cfd4af324d1f927c8b84fde48667~mv2.jpg', maps:'https://goo.gl/maps/83bkXUsLDYgP7YsX8', gc:'https://gentsclubs.com/gc/babylon'},
  {id:6 , name:'Babylon Paradise', area:'3rd Road', initial:'B', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_4116cfd4af324d1f927c8b84fde48667~mv2.jpg', maps:'https://goo.gl/maps/Cm1uvcua7uHubbLK6', gc:'https://gentsclubs.com/gc/babylon-paradise'},
  {id:7 , name:'Bada Bing', area:'Soi Bonkot 8', initial:'B', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_d09dafbd306f4106abd376ada3218171~mv2.jpg', maps:'https://goo.gl/maps/RSyNjyjNk3sJZNubA', gc:'https://gentsclubs.com/gc/bada-bing'},
  {id:8 , name:'Bradleys', area:'Soi Chaiyapoon', initial:'B', featured:true, logo:'https://static.wixstatic.com/media/5b8e36_29e11fa058334721a2a5f51dbf87b2c8~mv2.jpg', maps:'https://maps.app.goo.gl/VJNanqgD2ceWv1B57', gc:'https://gentsclubs.com/gc/bradleys'},
  {id:9 , name:'Bunny Bar', area:'The Darkside', initial:'B', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_fcb9bd404edd4855807f09668ee74fe0~mv2.png', maps:'https://goo.gl/maps/XLk12zK5gXBQA2gt7', gc:'https://gentsclubs.com/gc/bunny-bar'},
  {id:10, name:'Butterfly Club', area:'The Darkside', initial:'B', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_d7898790383b4f2ebd18738e1a88f3dd~mv2.png', maps:'https://maps.app.goo.gl/qNBkrv23YY5RGdQcA', gc:'https://gentsclubs.com/gc/butterfly-club'},
  {id:11, name:'Buzzin Lounge', area:'Soi Chaiyapoon', initial:'B', featured:true, logo:'https://static.wixstatic.com/media/a7bc28_7de9dcde3de943f49ba222cee38a6954~mv2.jpg', maps:'https://goo.gl/maps/6FZGyVMPmMjn3qCa6', gc:'https://gentsclubs.com/gc/buzzin-lounge'},
  {id:12, name:'Carre Blanc', area:'Soi Bonkot 8', initial:'C', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_8973e0028b644da1aeea21d327d8f7cf~mv2.jpg', maps:'https://goo.gl/maps/of2dz5MnLhngEVVj6', gc:'https://gentsclubs.com/gc/carre-blanc'},
  {id:13, name:'CatFlaps', area:'Pratumnak', initial:'C', featured:true, logo:'https://static.wixstatic.com/media/a7bc28_e3b41b2f840546518ff7496d025ea080~mv2.png', maps:'https://goo.gl/maps/VqxCXUdsZWhe7W549', gc:'https://gentsclubs.com/gc/catflaps'},
  {id:14, name:'Cleo\'s Hideout', area:'Soi Boomerang', initial:'C', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_5b3ef4d7989143888631ee4ccb30b4c1~mv2.jpeg', maps:'https://maps.app.goo.gl/vb5ZTFkAAFrJKnLs9', gc:'https://gentsclubs.com/gc/cleos-hideout'},
  {id:15, name:'Club 555', area:'Soi Boomerang', initial:'C', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_d8318e0f1a0f4bd08c917f3d43e06d29~mv2.jpg', maps:'https://maps.app.goo.gl/CYExvbjDPmvm23h8A', gc:'https://gentsclubs.com/gc/club-555'},
  {id:16, name:'Club Fate', area:'Soi Boomerang', initial:'C', featured:true, logo:'https://static.wixstatic.com/media/a7bc28_5a8db80763924a0baf79f1aabe7b8ce7~mv2.png', maps:'https://goo.gl/maps/3PRHmFBHfJheTDgK7', gc:'https://gentsclubs.com/gc/club-fate'},
  {id:17, name:'Club Secret', area:'Soi Bonkot 8', initial:'C', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_c3c436a364b7462a8fd344e57d1d81d6~mv2.jpeg', maps:'https://goo.gl/maps/oXTS1URVdpTttdep9', gc:'https://gentsclubs.com/gc/club-secret'},
  {id:18, name:'Club Sin', area:'Soi Bonkot 8', initial:'C', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_9803f152e334432a8ed3199b0afd1615~mv2.jpg', maps:'https://goo.gl/maps/Aja9eFyB65Jw3zYB8', gc:'https://gentsclubs.com/gc/club-sin'},
  {id:19, name:'Cobra Lounge', area:'Pratumnak', initial:'C', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_67a3dda096604d0ea879f8b95ffdffd3~mv2.jpg', maps:'https://goo.gl/maps/6WY2BBwPxDrRke4D7', gc:'https://gentsclubs.com/gc/cobra-lounge'},
  {id:20, name:'Cosy Beach Club', area:'Pratumnak', initial:'C', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_e34a0d9f08cc4c30b2aa35d54365d4ec~mv2.jpg', maps:'https://goo.gl/maps/BrJtVWicHzmmSPhS6', gc:'https://gentsclubs.com/gc/cosy-beach-club'},
  {id:21, name:'Dao Bar', area:'The Darkside', initial:'D', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_cfc1bb98cd53443cbff4ff97882c45ae~mv2.jpg', maps:'https://goo.gl/maps/sqJLMsy8Zc7NE3F98', gc:'https://gentsclubs.com/gc/dao-bar'},
  {id:22, name:'Darkside Gentlemans Club', area:'The Darkside', initial:'D', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_fe66c948eb5549168f6f21df3aafbadf~mv2.jpg', maps:'https://goo.gl/maps/87TGpjFC9PJagktk8', gc:'https://gentsclubs.com/gc/darkside-gentlemans-club'},
  {id:23, name:'Darksiders Genesis Bar', area:'The Darkside', initial:'D', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_4b831d7f60d249f48e5322c55bc07cfb~mv2.jpg', maps:'https://goo.gl/maps/zDbiUFcbkJPhkEb46', gc:'https://gentsclubs.com/gc/darksiders-genesis-bar'},
  {id:24, name:'Excite Club', area:'Soi Excite', initial:'E', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_0717b447684d41888522dcfe83c15c2a~mv2.jpg', maps:'https://goo.gl/maps/P8ZZsirFprtB3Uk69', gc:'https://gentsclubs.com/gc/excite-club'},
  {id:25, name:'Free Willy', area:'Soi Kophai', initial:'F', featured:true, logo:'https://static.wixstatic.com/media/a7bc28_aeb9d92babe0464a9b81d9cdd9beaf10~mv2.png', maps:'https://goo.gl/maps/gtFG8mxfZpXteEo59', gc:'https://gentsclubs.com/gc/freewilly'},
  {id:26, name:'Heaven Above', area:'Soi Boomerang', initial:'H', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_d3de19fdf62f47fbb87f510b2405bd86~mv2.jpg', maps:'https://goo.gl/maps/tAcHVMciENSXMsJj7', gc:'https://gentsclubs.com/gc/heaven-above'},
  {id:27, name:'High Rollers', area:'Soi Chaiyapoon', initial:'H', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_147d3350982945629c2d911099be4738~mv2.jpg', maps:'https://goo.gl/maps/nwTzkrtccpidXHE86', gc:'https://gentsclubs.com/gc/high-rollers'},
  {id:28, name:'Hunny Lounge', area:'Soi Honey', initial:'H', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_7c6c0cf1a8aa45d384b705c4e09e4dde~mv2.jpg', maps:'https://goo.gl/maps/uvEDpW2oVHZe3VwVA', gc:'https://gentsclubs.com/gc/hunny-lounge'},
  {id:29, name:'Jade House', area:'Jomtien', initial:'J', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_511f1c2e932a407d8c5ea90be06b9fb3~mv2.jpg', maps:'https://goo.gl/maps/srnaNAY9A6CHbDUi7', gc:'https://gentsclubs.com/gc/jade-house'},
  {id:30, name:'Juicy Lucy', area:'Soi Bonkot 8', initial:'J', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_d3b8d72dc6d94cfa9aeba3cb4b4a9c4b~mv2.jpg', maps:'https://maps.app.goo.gl/nm8zTzc3QcNVAU6a6', gc:'https://gentsclubs.com/gc/juicy-lucy'},
  {id:31, name:'Kings Club', area:'3rd Road', initial:'K', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_4e64da9ffc6346c5a4a81371a8373296~mv2.jpg', maps:'https://goo.gl/maps/7pr7s8NMLfvc47A46', gc:'https://gentsclubs.com/gc/kings-club'},
  {id:32, name:'Kinnaree', area:'Pratumnak', initial:'K', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_eb864aa59eda4ca0b43a7ef3d6aaacb2~mv2.jpg', maps:'https://goo.gl/maps/Gn4tAGKeMEYH9NtU6', gc:'https://gentsclubs.com/gc/kinnaree'},
  {id:33, name:'Kissx', area:'The Darkside', initial:'K', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_cadd324994434430822cd58e25d9431b~mv2.png', maps:'https://maps.app.goo.gl/Vx9sMdiChTtVAWov9', gc:'https://gentsclubs.com/gc/kissx'},
  {id:34, name:'KitCat', area:'Jomtien', initial:'K', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_b234247985a44f09ab37d68a08700e77~mv2.png', maps:'https://goo.gl/maps/MTiLMsjrekVAy6VH9', gc:'https://gentsclubs.com/gc/kitcat'},
  {id:35, name:'La Poste', area:'Soi Lengkee', initial:'L', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_ae44b5eb506a47599b0e50e64ac84339~mv2.jpg', maps:'https://goo.gl/maps/zwYrmUQVXyonMBaq5', gc:'https://gentsclubs.com/gc/la-poste'},
  {id:36, name:'Legs Eleven', area:'Soi Honey', initial:'L', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_4dda25fa309c4d0a9f08c70169fee621~mv2.jpg', maps:'https://goo.gl/maps/Fo93NvmEjE9YfbxP8', gc:'https://gentsclubs.com/gc/legs-eleven'},
  {id:37, name:'MClub', area:'3rd Road', initial:'M', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_7d89691fafa64431ba73d503fd7bf9f0~mv2.jpg', maps:'https://goo.gl/maps/CB27VcPDunbcvEgL6', gc:'https://gentsclubs.com/gc/mclub'},
  {id:38, name:'Madams', area:'3rd Road', initial:'M', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_efcd755a6bfe4d298223c81379db6792~mv2.png', maps:'https://maps.app.goo.gl/Xt8Vu4K1ZVhbsFe76', gc:'https://gentsclubs.com/gc/madams'},
  {id:39, name:'Maggie Mays', area:'Soi Chaiyapoon', initial:'M', featured:true, logo:'https://static.wixstatic.com/media/a7bc28_dc421c93e4a24a4d897a3c671eaa2a83~mv2.png', maps:'https://goo.gl/maps/eczsfsYtYn3E3eGM6', gc:'https://gentsclubs.com/gc/maggie-mays'},
  {id:40, name:'Maggie Mays Darkside', area:'The Darkside', initial:'M', featured:true, logo:'https://static.wixstatic.com/media/5b8e36_7f68b38db1a64f5cb610a4572d834852~mv2.png', maps:'https://maps.app.goo.gl/3CgEqiXQEftd9Ued6', gc:'https://gentsclubs.com/gc/maggie-mays-darkside'},
  {id:41, name:'Maggie Mays Jomtien', area:'Jomtien', initial:'M', featured:true, logo:'https://static.wixstatic.com/media/5b8e36_fb2c7a57977c46ad82307d6675b1aa94~mv2.jpg', maps:'https://maps.app.goo.gl/6UpwrHN3ALj5Diit7', gc:'https://gentsclubs.com/gc/maggie-mays-jomtien'},
  {id:42, name:'Maggie Mays Resort', area:'Jomtien', initial:'M', featured:true, logo:'https://static.wixstatic.com/media/5b8e36_f4a50be4d088491f8abb12387363523c~mv2.jpg', maps:'https://maps.app.goo.gl/NLZfwsTgAq25pjZQA', gc:'https://gentsclubs.com/gc/maggie-mays-resort'},
  {id:43, name:'Malibu Club', area:'Soi Bonkot 5', initial:'M', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_5b2d501a91784053bea2b95901641e36~mv2.jpg', maps:'https://goo.gl/maps/83bkXUsLDYgP7YsX8', gc:'https://gentsclubs.com/gc/malibu-club'},
  {id:44, name:'Manuya', area:'Soi Bonkot 8', initial:'M', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_3d12b9f947b44ad493c173fc59ab1baa~mv2.png', maps:'https://goo.gl/maps/dE2aNHuDqe6Yb2xQ8', gc:'https://gentsclubs.com/gc/manuya'},
  {id:45, name:'Mirror Club', area:'Naklua', initial:'M', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_f3605af7fc7c4394ab4aff9a028903b3~mv2.jpg', maps:'https://maps.app.goo.gl/i5rvY6XH8b3wRR8T9', gc:'https://gentsclubs.com/gc/mirror-club'},
  {id:46, name:'Monkey House', area:'Jomtien', initial:'M', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_c9609d8af1fa4ac5b2752ec9d64720c3~mv2.jpg', maps:'https://maps.app.goo.gl/NLuM5vMw3rNbQLJ99', gc:'https://gentsclubs.com/gc/monkey-house'},
  {id:47, name:'New Secret Bar', area:'The Darkside', initial:'N', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_c27ee62cc5e04a7c99c9c4c93d6c59d1~mv2.png', maps:'https://goo.gl/maps/7y7FDdQdXVFY8BRE6', gc:'https://gentsclubs.com/gc/new-secret-bar'},
  {id:48, name:'Nirvana', area:'Jomtien', initial:'N', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_f08c9ced1d034aea90df132e5c19351d~mv2.png', maps:'https://goo.gl/maps/H9Du9aNroLmKttYs7', gc:'https://gentsclubs.com/gc/nirvana'},
  {id:49, name:'Octopussy Club', area:'Soi Boomerang', initial:'O', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_c24555ab46b04b519a79b222b05351ee~mv2.jpg', maps:'https://goo.gl/maps/HjtkcKwtjbnW5xC89', gc:'https://gentsclubs.com/gc/octopussy-club'},
  {id:50, name:'Olivia\'s Club', area:'Soi Excite', initial:'O', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_18f5d39fadc347e9b366f18c79f99316~mv2.jpg', maps:'https://goo.gl/maps/4Hfv6jD4vqHAWwjq7', gc:'https://gentsclubs.com/gc/olivias-club'},
  {id:51, name:'Pacha Pattaya', area:'The Darkside', initial:'P', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_490f9f4b0a7841659d0083f3271e47ff~mv2.png', maps:'https://goo.gl/maps/sCDA4rxQUq4MUAu26', gc:'https://gentsclubs.com/gc/pacha-pattaya'},
  {id:52, name:'Paradise Bar', area:'The Darkside', initial:'P', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_afab2db8b11b4d9e8bcf08a2d6da2ac2~mv2.jpg', maps:'https://maps.app.goo.gl/bsFDYFa7Ktc5TiNJA', gc:'https://gentsclubs.com/gc/paradise-bar'},
  {id:53, name:'Passion', area:'Jomtien', initial:'P', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_4e52b12cb97a44498488baa31d11e323~mv2.jpg', maps:'https://goo.gl/maps/bTZFyxMRNfZmSvvy5', gc:'https://gentsclubs.com/gc/passion'},
  {id:54, name:'Pinky\'s', area:'Soi Bonkot', initial:'P', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_c83b072153584594bead335ab7583a69~mv2.jpg', maps:'https://maps.app.goo.gl/uvhzMiSrvsB6Km7J7', gc:'https://gentsclubs.com/gc/pinkys'},
  {id:55, name:'Pirates', area:'Soi Bonkot 8', initial:'P', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_30533b7a37d34dc683733aa16949e725~mv2.jpg', maps:'https://goo.gl/maps/yo9GRhxYdgHjJNwR6', gc:'https://gentsclubs.com/gc/pirates'},
  {id:56, name:'Purple Club', area:'Soi Bonkot 8', initial:'P', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_626bf097fb28453885e48e377c2a2629~mv2.jpg', maps:'https://goo.gl/maps/QsUKLFxEd5ey8wRY9', gc:'https://gentsclubs.com/gc/purple-club'},
  {id:57, name:'Pussy Galore', area:'Jomtien', initial:'P', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_045a934f49e2466a82e0b6a1f3f4b4c8~mv2.jpg', maps:'https://goo.gl/maps/yBxAjzEY74LNfm1k6', gc:'https://gentsclubs.com/gc/pussy-galore'},
  {id:58, name:'Red Hot and Blue', area:'Soi Buakhao', initial:'R', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_8e13970b49d04392824c3529e61b6fef~mv2.jpeg', maps:'https://goo.gl/maps/hM6ez6vDyjeJXWr57', gc:'https://gentsclubs.com/gc/red-hot-and-blue'},
  {id:59, name:'Red Lantern', area:'Soi Boomerang', initial:'R', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_9b01e964ba7a44ffba9109b46525b10d~mv2.jpg', maps:'https://maps.app.goo.gl/1btoFx2K7ik3fjV59', gc:'https://gentsclubs.com/gc/red-lantern'},
  {id:60, name:'Secret Lounge', area:'Soi Excite', initial:'S', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_5e19d46b215941619b49adaa09c9a43b~mv2.png', maps:'https://goo.gl/maps/y6YtZ7RamaX7XtAn7', gc:'https://gentsclubs.com/gc/secret-lounge'},
  {id:61, name:'Telephone Bar', area:'Soi Batman', initial:'T', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_8fd76887489c458db53f74e34526528a~mv2.jpg', maps:'https://goo.gl/maps/2N2K5m17C8bpP5dR8', gc:'https://gentsclubs.com/gc/telephone-bar'},
  {id:62, name:'The Badger', area:'The Darkside', initial:'T', featured:true, logo:'https://static.wixstatic.com/media/5b8e36_df0114fc04a5462681bb3377fbf78ba0~mv2.jpg', maps:'https://maps.app.goo.gl/ySFQYkGXZnXAA4yo9', gc:'https://gentsclubs.com/gc/the-badger'},
  {id:63, name:'The Bird Cage', area:'The Darkside', initial:'T', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_b56c1b91512a4ffd93b0d91a6d0838be~mv2.jpg', maps:'https://goo.gl/maps/YeMcVGGp4DnRdF5F7', gc:'https://gentsclubs.com/gc/the-bird-cage'},
  {id:64, name:'The Brass House', area:'Jomtien', initial:'T', featured:true, logo:'https://static.wixstatic.com/media/a7bc28_1f8bb9f4c981494782e699e00dbf219d~mv2.png', maps:'https://maps.app.goo.gl/4iGFNUHk9zg3VMeR8', gc:'https://gentsclubs.com/gc/the-brass-house'},
  {id:65, name:'The Camel Toe', area:'Soi Kophai', initial:'T', featured:true, logo:'https://static.wixstatic.com/media/a7bc28_5b763161eb1347d09d253af7b260f3a0~mv2.png', maps:'https://goo.gl/maps/yyTT1aGTrSivaqND9', gc:'https://gentsclubs.com/gc/the-camel-toe'},
  {id:66, name:'The Cat House', area:'Soi Boomerang', initial:'T', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_a00920cf686549bd928a6b3342575b7a~mv2.jpg', maps:'https://maps.app.goo.gl/4qYVSv5PEEC2PTjn8', gc:'https://gentsclubs.com/gc/the-cat-house'},
  {id:67, name:'The Den', area:'Soi Chaiyapoon', initial:'T', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_7b5eb7651bda4263b94f61db9756bcdb~mv2.png', maps:'https://goo.gl/maps/fJkhhykMtEgQVx8h8', gc:'https://gentsclubs.com/gc/the-den'},
  {id:68, name:'The Factory', area:'Soi Bonkot 8', initial:'T', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_6f78c75e5e5e4bc1bbb2cdbb82c269e6~mv2.jpg', maps:'https://maps.app.goo.gl/M5XebwVzKTa2j1KY8', gc:'https://gentsclubs.com/gc/the-factory'},
  {id:69, name:'The Naughty Club', area:'Soi Boomerang', initial:'T', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_0d52193cc7354e3b92a67e67fb9e7e33~mv2.jpg', maps:'https://goo.gl/maps/G5UU9Ky6TDaMuPoM9', gc:'https://gentsclubs.com/gc/the-naughty-club'},
  {id:70, name:'The Pussy Cat Club', area:'The Darkside', initial:'T', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_554e18e98aae494dac19209a0056a2cf~mv2.png', maps:'https://goo.gl/maps/STttotVPfxf6ZWRD8', gc:'https://gentsclubs.com/gc/the-pussy-cat-club'},
  {id:71, name:'Throbin Wood', area:'Jomtien', initial:'T', featured:true, logo:'https://static.wixstatic.com/media/5b8e36_1876c237f37e47fe8ab9ee32a2d9313c~mv2.png', maps:'https://maps.app.goo.gl/HPDatwJyyLh5LtgEA', gc:'https://gentsclubs.com/gc/throbin-wood'},
  {id:72, name:'Tiger Club', area:'Soi Bonkot 8', initial:'T', featured:false, logo:'https://static.wixstatic.com/media/5b8e36_8865cbb36e854784b951886b10fef47e~mv2.jpg', maps:'https://maps.app.goo.gl/9nNkGMaGEHYK1gr9A', gc:'https://gentsclubs.com/gc/tiger-club'},
  {id:73, name:'Venom', area:'Pratumnak', initial:'V', featured:false, logo:'https://static.wixstatic.com/media/a7bc28_6b5dfa8e51dc46c4ab96fec1adbf89e7~mv2.jpg', maps:'https://goo.gl/maps/6WY2BBwPxDrRke4D7', gc:'https://gentsclubs.com/gc/venom'}
];

const SCORES={S:100,A:80,B:60,C:40,D:20,F:0};

// ── CLUB ORDER: featured first (shuffled), then non-featured (shuffled) ──
function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }
function buildClubOrder(){
  const featured = shuffle(CLUBS.filter(c=>c.featured));
  const rest     = shuffle(CLUBS.filter(c=>!c.featured));
  return [...featured, ...rest];
}

// Minimum clubs to rate before "submit early" option appears (about 50%)


const state={
  user:null, activeCrit:null,
  rankings:{}, weeklyDone:{}, clubOrder:{},
  simData:{}, lbCrit:'value', lbTime:'weekly'
};

CRITERIA.forEach(c=>{
  state.rankings[c.id]={};
});

// ── SCREENS ──
function showScreen(id,tab){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('screen-'+id).classList.add('active');
  tab.classList.add('active');
  if(id==='leaderboard') renderLb();
  if(id==='rate') goHome();
}

// ── CRITERIA HOME ──
function goHome(){
  const cid = state.activeCrit;
  // If no active criteria or already fully done, just go home
  if(!cid || state.weeklyDone[cid]){
    _doGoHome();
    return;
  }
  const total = CLUBS.length;
  const done = total - unranked(cid).length;
  // If they haven't rated anything yet, go straight back — nothing to lose
  if(done === 0){
    _doGoHome();
    return;
  }
  // Otherwise show the exit warning
  const pct = Math.round((done / total) * 100);
  const crit = CRITERIA.find(x=>x.id===cid);
  document.getElementById('exitModalSub').textContent =
    `You've rated ${done} of ${total} clubs (${pct}%) for "${crit.label}". Your progress will be lost if you go back without submitting.`;
  document.getElementById('exitModal').classList.add('show');
}

function closeExitModal(){
  document.getElementById('exitModal').classList.remove('show');
}

function exitAndSubmit(){
  closeExitModal();
  const cid = state.activeCrit;
  completeVoting(cid);
}

function exitAndDiscard(){
  closeExitModal();
  const cid = state.activeCrit;
  // Clear any ratings done so far for this criteria
  state.rankings[cid] = {};
  delete state.clubOrder[cid];
  _doGoHome();
}

function _doGoHome(){
  state.activeCrit = null;
  document.getElementById('criteriaHome').style.display='block';
  document.getElementById('votePage').style.display='none';
  renderGrid();
  updateTimer();
}

function renderGrid(){
  document.getElementById('guestNotice').style.display=state.user?'none':'block';
  const grid=document.getElementById('criteriaGrid');
  grid.innerHTML=CRITERIA.map(c=>{
    const done=!!state.weeklyDone[c.id];
    const locked=!state.user;
    const unverified = state.user && !state.user.verified;
    const ranked=Object.keys(state.rankings[c.id]).length;
    const pct=(ranked/CLUBS.length)*100;
    let cls, status, onclick='';
    if(locked){
      cls='locked';
      status=`<div class="cc-status status-locked">🔒 Sign in to rate</div>`;
    } else if(unverified){
      cls='locked';
      status=`<div class="cc-status status-locked">✉️ Verify email to rate</div>`;
    } else if(done){
      cls='completed';
      status=`<div class="cc-status status-completed">✓ Submitted this week</div>`;
    } else {
      cls='available';
      status=`<div class="cc-status status-available">Tap to Rate →</div>`;
      onclick=`startVoting('${c.id}')`;
    }
    return `<div class="criteria-card ${cls}" onclick="${onclick}">
      <div class="cc-icon">${c.icon}</div>
      <div class="cc-title">${c.label}</div>
      <div class="cc-desc">${c.desc}</div>
      ${status}
      ${!done?`<div class="cc-prog" style="width:${pct}%"></div>`:''}
      ${cls==='available'?`<div class="cc-arrow">→</div>`:''}
    </div>`;
  }).join('');
}

// ── VOTING ──
function startVoting(cid){
  state.activeCrit=cid;
  // Build a fresh featured-first shuffled order for this session
  if(!state.clubOrder[cid]){
    state.clubOrder[cid] = buildClubOrder();
  }
  const c=CRITERIA.find(x=>x.id===cid);
  document.getElementById('criteriaHome').style.display='none';
  document.getElementById('votePage').style.display='block';
  document.getElementById('voteComplete').classList.remove('show');
  document.getElementById('tierSection').style.display='block';
  document.getElementById('clubCard').style.display='flex';
  document.getElementById('vCritTitle').textContent=c.label;
  document.getElementById('vCritSub').textContent=c.desc;
  renderVoteCard();
}

function unranked(cid){
  const order = state.clubOrder[cid] || CLUBS;
  return order.filter(cl=>!(cl.id in state.rankings[cid]));
}

function renderVoteCard(){
  const cid=state.activeCrit;
  const rem=unranked(cid);
  const total=CLUBS.length;
  const done=total-rem.length;
  const pct=Math.round((done/total)*100);
  document.getElementById('vProgPct').textContent=`${pct}%`;
  document.getElementById('vProgFill').style.width=`${pct}%`;

  if(!rem.length){
    completeVoting(cid);
    return;
  }
  const cl=rem[0];
  document.getElementById('cardNum').textContent=`${done+1} of ${total}`;
  document.getElementById('clubName').textContent=cl.name;
  document.getElementById('clubArea').textContent=cl.area;
  // Show logo image if available, otherwise show initial
  const logoBox = document.getElementById('clubLogo');
  if(cl.logo){
    logoBox.innerHTML=`<img src="${cl.logo}" alt="${cl.name}" onerror="this.parentNode.innerHTML='${cl.initial}'">`;
  } else {
    logoBox.textContent=cl.initial;
  }
}

function completeVoting(cid){
  state.weeklyDone[cid]=true;
  document.getElementById('clubCard').style.display='none';
  document.getElementById('tierSection').style.display='none';
  document.getElementById('voteComplete').classList.add('show');
  // Save to Firestore if user is logged in and verified
  if(state.user && state.user.verified && typeof saveSubmissionToFirestore === 'function'){
    saveSubmissionToFirestore(cid, state.rankings[cid]).catch(err => console.error('Save failed:', err));
  }
}


function assign(tier){
  const cid=state.activeCrit;
  const rem=unranked(cid);
  if(!rem.length) return;
  state.rankings[cid][rem[0].id]=tier;
  if(tier!=='SKIP') showToast(tier);
  const card=document.getElementById('clubCard');
  card.style.transition='transform 0.3s ease,opacity 0.3s ease';
  if(tier==='SKIP'){ card.style.transform='translateY(-26px)'; card.style.opacity='0'; }
  else if(['S','A','B'].includes(tier)){ card.style.transform='translateX(130px) rotate(7deg)'; card.style.opacity='0'; }
  else { card.style.transform='translateX(-130px) rotate(-7deg)'; card.style.opacity='0'; }
  setTimeout(()=>{
    card.style.transition='none'; card.style.transform=''; card.style.opacity='1';
    renderVoteCard();
    setTimeout(()=>{ card.style.transition=''; },30);
  },310);
}

function showToast(tier){
  const colors={S:'var(--s)',A:'var(--a)',B:'var(--b)',C:'var(--c)',D:'var(--d)',F:'var(--f)'};
  const t=document.getElementById('feedbackToast');
  t.textContent=tier+' Tier'; t.style.color=colors[tier];
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),650);
}

// ── LEADERBOARD ──
async function renderLb(){
  const pills=document.getElementById('lbPills');
  pills.innerHTML=CRITERIA.map(c=>`<button class="pill ${c.id===state.lbCrit?'active':''}" onclick="setLbCrit('${c.id}')">${c.label}</button>`).join('');

  const lbList = document.getElementById('lbList');

  // Show loading state
  lbList.innerHTML=`<div class="lb-empty">
    <div style="font-size:1.5rem;margin-bottom:8px">⏳</div>
    <div>Loading rankings...</div>
  </div>`;

  try {
    // Fetch real data from Firestore if available
    let scores = [];
    if(typeof loadLeaderboardData === 'function'){
      const data = await loadLeaderboardData(state.lbCrit, state.lbTime);
      scores = data
        .map(row => {
          const cl = CLUBS.find(c => c.id === row.clubId);
          if(!cl) return null;
          return { cl, sc: row.avgScore, v: row.voteCount };
        })
        .filter(Boolean)
        .sort((a,b) => b.sc - a.sc)
        .slice(0, 10);
    }

    if(!scores.length){
      lbList.innerHTML=`<div class="lb-empty">
        <div style="font-size:2rem;margin-bottom:10px">🏆</div>
        <div style="margin-bottom:6px">No rankings yet for this timeframe.</div>
        <div style="font-size:0.78rem;color:var(--grey)">Be the first to rate clubs and claim the top spot.</div>
      </div>`;
      return;
    }

    lbList.innerHTML=scores.map((item,i)=>{
      const cls=item.sc>=75?'sh':item.sc>=50?'sm':'sl';
      const logoHtml = item.cl.logo
        ? `<img src="${item.cl.logo}" alt="${item.cl.name}" onerror="this.parentNode.textContent='${item.cl.initial}'">`
        : item.cl.initial;
      const links = [
        item.cl.maps ? `<a class="lb-link lb-link-maps" href="${item.cl.maps}" target="_blank" rel="noopener">📍 Maps</a>` : '',
        item.cl.gc   ? `<a class="lb-link lb-link-gc"   href="${item.cl.gc}"   target="_blank" rel="noopener">ℹ Info</a>` : '',
      ].join('');
      return`<div class="lb-item" onclick="openClubModal(${item.cl.id})" style="cursor:pointer">
        <div class="lb-rank">${i+1}</div>
        <div class="lb-logo">${logoHtml}</div>
        <div class="lb-info">
          <div class="lb-name">${item.cl.name}</div>
          <div class="lb-meta">${item.cl.area} · ${item.v} vote${item.v===1?'':'s'}</div>
          ${links ? `<div class="lb-links">${links}</div>` : ''}
        </div>
        <div class="lb-score-wrap"><div class="lb-score ${cls}">${item.sc}</div><div class="lb-score-lbl">Score</div></div>
      </div>`;
    }).join('');

  } catch(err) {
    console.error('Leaderboard load failed:', err);
    // Surface the Firebase index link if that's the error
    lbList.innerHTML=`<div class="lb-empty">
      <div style="font-size:1.5rem;margin-bottom:8px">⚠️</div>
      <div>Could not load rankings.</div>
      <div style="font-size:0.78rem;color:var(--grey);margin-top:6px">Check the browser console for details.</div>
    </div>`;
  }
}

function setLbCrit(id){ state.lbCrit=id; renderLb(); }
function setTime(t,el){ state.lbTime=t; document.querySelectorAll('.time-tab').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderLb(); }

// ── CLUB DETAIL MODAL ──
async function openClubModal(clubId) {
  const cl = CLUBS.find(c => c.id === clubId);
  if (!cl) return;

  const modal = document.getElementById('clubModal');
  const content = document.getElementById('clubModalContent');
  modal.classList.add('show');

  // Logo
  const logoHtml = cl.logo
    ? `<img src="${cl.logo}" alt="${cl.name}" onerror="this.parentNode.innerHTML='${cl.initial}'">`
    : cl.initial;

  // External links
  const links = [
    cl.maps ? `<a class="lb-link lb-link-maps" href="${cl.maps}" target="_blank" rel="noopener">📍 Maps</a>` : '',
    cl.gc   ? `<a class="lb-link lb-link-gc"   href="${cl.gc}"   target="_blank" rel="noopener">ℹ Info</a>` : '',
  ].filter(Boolean).join('');

  // Show header immediately, scores loading
  content.innerHTML = `
    <div class="club-modal-header">
      <div class="club-modal-logo">${logoHtml}</div>
      <div>
        <div class="club-modal-name">${cl.name}</div>
        <div class="club-modal-area">${cl.area}</div>
        ${links ? `<div class="club-modal-links">${links}</div>` : ''}
      </div>
    </div>
    <div id="clubModalScores">
      <div class="club-modal-empty">⏳ Loading scores...</div>
    </div>`;

  try {
    const critMap = await loadClubDetail(clubId, state.lbTime);
    const scoresEl = document.getElementById('clubModalScores');

    const rows = CRITERIA.map(c => {
      const data = critMap[c.id];
      if (!data || data.voteCount === 0) {
        return `<div class="criteria-score-row">
          <div class="cs-label">${c.label}</div>
          <div class="cs-bar-wrap"><div class="cs-bar" style="width:0%;background:var(--border)"></div></div>
          <div class="cs-score" style="color:var(--grey)">—</div>
          <div class="cs-votes">no votes</div>
        </div>`;
      }
      const avg = Math.round(data.totalScore / data.voteCount);
      const barColour = avg >= 75 ? 'var(--a)' : avg >= 50 ? 'var(--c)' : 'var(--d)';
      const scoreColour = avg >= 75 ? 'sh' : avg >= 50 ? 'sm' : 'sl';
      return `<div class="criteria-score-row">
        <div class="cs-label">${c.label}</div>
        <div class="cs-bar-wrap"><div class="cs-bar" style="width:${avg}%;background:${barColour}"></div></div>
        <div class="cs-score ${scoreColour}">${avg}</div>
        <div class="cs-votes">${data.voteCount} vote${data.voteCount===1?'':'s'}</div>
      </div>`;
    });

    const hasAnyData = CRITERIA.some(c => critMap[c.id]?.voteCount > 0);
    scoresEl.innerHTML = hasAnyData
      ? `<div class="criteria-scores">${rows.join('')}</div>`
      : `<div class="club-modal-empty">No ratings yet for this club.<br><span style="font-size:0.78rem">Be the first to rate it.</span></div>`;

  } catch(err) {
    console.error('Club detail load failed:', err);
    document.getElementById('clubModalScores').innerHTML =
      `<div class="club-modal-empty">Could not load scores.</div>`;
  }
}

function closeClubModal() {
  document.getElementById('clubModal').classList.remove('show');
}

// ── TIMER ──
function updateTimer(){
  const now=new Date();
  const sun=new Date(now);
  const d=(7-now.getDay())%7||7;
  sun.setDate(now.getDate()+d); sun.setHours(0,0,0,0);
  const diff=sun-now;
  const days=Math.floor(diff/86400000);
  const hrs=Math.floor((diff%86400000)/3600000);
  const mins=Math.floor((diff%3600000)/60000);
  const el=document.getElementById('resetTimer');
  if(el) el.textContent=`Weekly reset in ${days}d ${hrs}h ${mins}m — every Sunday at midnight`;
}
setInterval(updateTimer,60000);

// ── AUTH ──
function openModal(v){
  document.getElementById('authModal').classList.add('show');
  document.getElementById('loginView').style.display = v==='login' ? 'block' : 'none';
  document.getElementById('registerView').style.display = v==='register' ? 'block' : 'none';
  document.getElementById('verifyEmailView').style.display = 'none';
  // Clear any previous errors
  ['authError','authErrorReg'].forEach(id=>{ const e=document.getElementById(id); if(e){e.textContent='';e.style.display='none';} });
}
function closeModal(){ document.getElementById('authModal').classList.remove('show'); }
function switchToRegister(){
  document.getElementById('loginView').style.display='none';
  document.getElementById('registerView').style.display='block';
  document.getElementById('verifyEmailView').style.display='none';
  ['authError','authErrorReg'].forEach(id=>{ const e=document.getElementById(id); if(e){e.textContent='';e.style.display='none';} });
}
function switchToLogin(){
  document.getElementById('loginView').style.display='block';
  document.getElementById('registerView').style.display='none';
  document.getElementById('verifyEmailView').style.display='none';
  ['authError','authErrorReg'].forEach(id=>{ const e=document.getElementById(id); if(e){e.textContent='';e.style.display='none';} });
}

// These call into the Firebase module functions defined in the <script type="module"> above
function doLogin(){
  const e = document.getElementById('loginEmail').value.trim();
  const p = document.getElementById('loginPass').value;
  if(!e || !p){ showAuthErrorInline('Please enter your email and password.'); return; }
  if(typeof firebaseLogin === 'function') firebaseLogin(e, p);
  else showAuthErrorInline('Firebase not configured yet. See setup instructions.');
}

function doRegister(){
  const u = document.getElementById('regUsername').value.trim();
  const e = document.getElementById('regEmail').value.trim();
  const p = document.getElementById('regPass').value;
  if(!u || !e || !p){ showAuthErrorInline('Please fill in all fields.'); return; }
  if(p.length < 6){ showAuthErrorInline('Password must be at least 6 characters.'); return; }
  if(typeof firebaseRegister === 'function') firebaseRegister(u, e, p);
  else showAuthErrorInline('Firebase not configured yet. See setup instructions.');
}

function showAuthErrorInline(msg){
  const el = document.getElementById('authError');
  if(el){ el.textContent = msg; el.style.display = 'block'; }
}

function logout(){
  if(typeof firebaseLogout === 'function') firebaseLogout();
  else { state.user=null; updateHeader(); renderGrid(); }
}

function updateHeader(){
  if(state.user){
    const verifiedBadge = state.user.verified ? '✓' : '⚠';
    const badgeColor = state.user.verified ? 'color:var(--gold)' : 'color:#FFB347';
    document.getElementById('headerRight').innerHTML=
      `<button class="user-btn" onclick="openSettings()">
         <span style="${badgeColor};font-size:0.7rem">${verifiedBadge}</span>
         ${state.user.username}
         <span style="font-size:0.65rem;opacity:0.5">▾</span>
       </button>
       <button class="btn-login" onclick="logout()">Sign Out</button>`;
  } else {
    document.getElementById('headerRight').innerHTML=
      `<button class="btn-login" onclick="openModal('login')">Sign In</button>
       <button class="btn-primary" onclick="openModal('register')">Register</button>`;
  }
}

// ── SETTINGS ──
function openSettings(){
  document.getElementById('settingsModal').classList.add('show');
  // Populate current values
  document.getElementById('setUsername').value = state.user.username || '';
  document.getElementById('setEmail').value = state.user.email || '';
  settingsTab('profile');
}
function closeSettings(){
  document.getElementById('settingsModal').classList.remove('show');
  // Clear all password fields
  ['setCurrentPw','setNewPw','setConfirmPw','setEmailPw','setNewEmail','setDeletePw'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.value='';
  });
  clearSettingsMsg();
}
function settingsTab(tab){
  document.querySelectorAll('.settings-tab').forEach(b=>b.classList.toggle('active', b.dataset.tab===tab));
  document.querySelectorAll('.settings-panel').forEach(p=>p.classList.toggle('active', p.dataset.panel===tab));
  clearSettingsMsg();
}
function showSettingsMsg(msg, isError=false){
  const el = document.getElementById('settingsMsg');
  el.textContent = msg;
  el.style.color = isError ? '#e05555' : 'var(--gold)';
  el.style.display = 'block';
}
function clearSettingsMsg(){ document.getElementById('settingsMsg').style.display='none'; }

async function saveUsername(){
  const val = document.getElementById('setUsername').value.trim();
  if(!val) return showSettingsMsg('Username cannot be empty.', true);
  try {
    await window.firebaseChangeUsername(val);
    showSettingsMsg('Username updated!');
  } catch(e){ showSettingsMsg(e.message, true); }
}

async function savePassword(){
  const cur = document.getElementById('setCurrentPw').value;
  const nw  = document.getElementById('setNewPw').value;
  const cf  = document.getElementById('setConfirmPw').value;
  if(!cur || !nw) return showSettingsMsg('Please fill in all fields.', true);
  if(nw !== cf)  return showSettingsMsg('New passwords do not match.', true);
  if(nw.length < 6) return showSettingsMsg('Password must be at least 6 characters.', true);
  try {
    await window.firebaseChangePassword(cur, nw);
    document.getElementById('setCurrentPw').value='';
    document.getElementById('setNewPw').value='';
    document.getElementById('setConfirmPw').value='';
    showSettingsMsg('Password updated successfully!');
  } catch(e){
    showSettingsMsg(e.code==='auth/wrong-password'?'Current password is incorrect.':e.message, true);
  }
}

async function saveEmail(){
  const pw  = document.getElementById('setEmailPw').value;
  const em  = document.getElementById('setNewEmail').value.trim();
  if(!pw || !em) return showSettingsMsg('Please fill in all fields.', true);
  try {
    await window.firebaseChangeEmail(pw, em);
    document.getElementById('setEmailPw').value='';
    document.getElementById('setNewEmail').value='';
    showSettingsMsg('Verification sent to '+em+'. Click the link to confirm your new email.');
  } catch(e){
    showSettingsMsg(e.code==='auth/wrong-password'?'Password is incorrect.':e.message, true);
  }
}

async function sendPasswordReset(){
  try {
    await window.firebaseSendPasswordReset();
    showSettingsMsg('Password reset email sent to '+state.user.email);
  } catch(e){ showSettingsMsg(e.message, true); }
}

async function deleteAccount(){
  const pw = document.getElementById('setDeletePw').value;
  if(!pw) return showSettingsMsg('Please enter your password to confirm.', true);
  if(!confirm('Are you absolutely sure? This cannot be undone.')) return;
  try {
    await window.firebaseDeleteAccount(pw);
    closeSettings();
    showToastMsg('Account deleted.');
  } catch(e){
    showSettingsMsg(e.code==='auth/wrong-password'?'Password is incorrect.':e.message, true);
  }
}

document.getElementById('authModal').addEventListener('click',function(e){ if(e.target===this) closeModal(); });
document.getElementById('clubModal').addEventListener('click',function(e){ if(e.target===this) closeClubModal(); });

// ── INIT ──
renderGrid();
updateTimer();
renderLb();
</script>
<!-- Exit warning modal -->
<div class="modal-overlay" id="exitModal">
  <div class="modal">
    <div class="modal-title">Hold On!</div>
    <div class="modal-sub" id="exitModalSub"></div>
    <p style="font-size:0.88rem;color:var(--off-white);margin:16px 0 8px;">What would you like to do?</p>
    <div class="exit-actions">
      <button class="exit-btn-continue" onclick="closeExitModal()">↩ Keep Rating</button>
      <button class="exit-btn-submit" onclick="exitAndSubmit()">✓ Submit What I've Done</button>
      <button class="exit-btn-discard" onclick="exitAndDiscard()">✕ Discard &amp; Go Back</button>
    </div>
  </div>
</div>

<!-- Settings modal -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal" style="max-width:420px">
    <button class="modal-close" onclick="closeSettings()">×</button>
    <div class="modal-title">Account Settings</div>
    <div id="settingsMsg" style="display:none;font-size:0.85rem;margin-bottom:12px;padding:8px 10px;background:rgba(0,0,0,0.3);border-radius:4px;"></div>

    <div class="settings-tabs">
      <button class="settings-tab active" data-tab="profile" onclick="settingsTab('profile')">Profile</button>
      <button class="settings-tab" data-tab="password" onclick="settingsTab('password')">Password</button>
      <button class="settings-tab" data-tab="email" onclick="settingsTab('email')">Email</button>
      <button class="settings-tab" data-tab="danger" onclick="settingsTab('danger')">Account</button>
    </div>

    <!-- Profile -->
    <div class="settings-panel active" data-panel="profile">
      <div class="settings-field">
        <label>Username</label>
        <input type="text" id="setUsername" placeholder="Your display name" maxlength="30">
      </div>
      <div class="settings-field">
        <label>Email</label>
        <input type="email" id="setEmail" disabled style="opacity:0.5;cursor:not-allowed">
        <div class="settings-hint">To change your email address, use the Email tab.</div>
      </div>
      <div style="margin-top:16px">
        <button class="btn-primary" style="width:100%" onclick="saveUsername()">Save Username</button>
      </div>
    </div>

    <!-- Password -->
    <div class="settings-panel" data-panel="password">
      <div class="settings-field">
        <label>Current Password</label>
        <input type="password" id="setCurrentPw" placeholder="Enter current password">
      </div>
      <div class="settings-field">
        <label>New Password</label>
        <input type="password" id="setNewPw" placeholder="At least 6 characters">
      </div>
      <div class="settings-field">
        <label>Confirm New Password</label>
        <input type="password" id="setConfirmPw" placeholder="Repeat new password">
      </div>
      <div style="margin-top:16px;display:flex;gap:8px">
        <button class="btn-primary" style="flex:1" onclick="savePassword()">Update Password</button>
        <button class="btn-outline" onclick="sendPasswordReset()" title="Send reset link to your email">Reset via Email</button>
      </div>
    </div>

    <!-- Email -->
    <div class="settings-panel" data-panel="email">
      <div class="settings-hint" style="margin-bottom:14px">A verification link will be sent to your new address. Your email won't change until you click it.</div>
      <div class="settings-field">
        <label>New Email Address</label>
        <input type="email" id="setNewEmail" placeholder="new@example.com">
      </div>
      <div class="settings-field">
        <label>Current Password</label>
        <input type="password" id="setEmailPw" placeholder="Confirm your identity">
      </div>
      <div style="margin-top:16px">
        <button class="btn-primary" style="width:100%" onclick="saveEmail()">Send Verification</button>
      </div>
    </div>

    <!-- Account / Danger zone -->
    <div class="settings-panel" data-panel="danger">
      <div class="settings-hint" style="margin-bottom:16px">Deleting your account is permanent. All your ratings and data will be removed and cannot be recovered.</div>
      <div class="settings-field">
        <label>Confirm Password</label>
        <input type="password" id="setDeletePw" placeholder="Enter password to confirm">
      </div>
      <div style="margin-top:16px">
        <button class="btn-danger" style="width:100%" onclick="deleteAccount()">Delete My Account</button>
      </div>
    </div>
  </div>
</div>
<script>document.getElementById('settingsModal').addEventListener('click',function(e){ if(e.target===this) closeSettings(); });</script>

</body>
</html>
